---
import type { CollectionEntry } from "astro:content";
import BaseLayout from "./BaseLayout.astro";
import TableOfContents from "../components/TableOfContents.astro";
import Giscus from "../components/Giscus.astro";

interface Heading {
  depth: number;
  slug: string;
  text: string;
}

interface Props {
  post: CollectionEntry<"blog">;
  headings: Heading[];
  minutesRead: string;
}

const { post, headings, minutesRead } = Astro.props;
const {
  title,
  description,
  pubDate,
  updatedDate,
  heroImage,
  tags,
  category,
} = post.data;

const ogImage = `/og/${post.id}.png`;
---

<BaseLayout
  title={title}
  description={description}
  ogImage={ogImage}
  pubDate={pubDate}
  type="article"
>
  <div class="xl:grid xl:grid-cols-[1fr_15rem] xl:gap-12">
    <article>
      {heroImage && (
        <img
          src={heroImage}
          alt={title}
          class="mb-8 w-full rounded-lg object-cover"
          transition:name={`hero-${post.id}`}
        />
      )}

      <div class="mb-8">
        <h1
          class="mb-3 text-3xl font-bold leading-tight text-stone-900 dark:text-gray-50"
          data-pagefind-meta="title"
        >
          {title}
        </h1>

        <div class="flex flex-wrap items-center gap-3 text-sm text-stone-500 dark:text-gray-400">
          <time datetime={pubDate.toISOString()}>
            {pubDate.toLocaleDateString("ko-KR", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}
          </time>
          {updatedDate && (
            <span class="text-stone-400 dark:text-gray-500">
              (수정:{" "}
              {updatedDate.toLocaleDateString("ko-KR", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })}
              )
            </span>
          )}
          <span class="text-stone-300 dark:text-gray-600">·</span>
          <span>{minutesRead}</span>
        </div>

        <div class="mt-3 flex flex-wrap items-center gap-2">
          {category && (
            <span class="rounded border border-stone-600/30 bg-stone-600/10 px-2.5 py-0.5 text-xs font-medium text-stone-700 dark:border-stone-400/30 dark:bg-stone-400/10 dark:text-stone-400">
              {category}
            </span>
          )}
          {tags.length > 0 &&
            tags.map((tag) => (
              <span class="rounded-full bg-stone-100 px-3 py-0.5 text-xs text-stone-600 dark:bg-gray-800 dark:text-gray-400">
                #{tag}
              </span>
            ))}
        </div>
      </div>

      <div
        class="prose max-w-none prose-headings:text-stone-900 prose-a:text-stone-700 prose-a:no-underline hover:prose-a:underline prose-blockquote:border-l-stone-600 prose-blockquote:text-stone-600 prose-code:text-stone-700 prose-code:bg-stone-100 prose-code:rounded prose-code:px-1.5 prose-code:py-0.5 prose-code:before:content-none prose-code:after:content-none prose-pre:bg-transparent prose-pre:p-0 prose-img:rounded-lg prose-hr:border-stone-200 dark:prose-invert dark:prose-headings:text-gray-100 dark:prose-a:text-stone-400 dark:prose-blockquote:border-l-stone-400 dark:prose-blockquote:text-gray-300 dark:prose-code:text-stone-300 dark:prose-code:bg-gray-800 dark:prose-hr:border-gray-800"
        data-pagefind-body
      >
        <slot />
      </div>

      <Giscus />
    </article>

    <TableOfContents headings={headings} />
  </div>
</BaseLayout>