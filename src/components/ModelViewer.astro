---
import fs from "node:fs";
import path from "node:path";

interface Props {
  src: string;
  alt?: string;
}

const { src, alt = "3D 모델" } = Astro.props;

const publicPath = path.join(process.cwd(), "public", src);
const fileExists = fs.existsSync(publicPath);
---

{fileExists ? (
  <model-viewer
    src={src}
    alt={alt}
    auto-rotate
    rotation-per-second="30deg"
    interaction-prompt="none"
    loading="lazy"
    reveal="auto"
    role="link"
    aria-label="홈으로 이동"
    tabindex="0"
    style="display: block; width: 140px; height: 140px; margin: 0 auto; cursor: pointer;"
  ></model-viewer>
) : (
  <div></div>
)}

<script>
  import { navigate } from 'astro:transitions/client';

  function initModelViewerNav() {
    const viewer = document.querySelector('model-viewer');
    if (!viewer) return;
    viewer.addEventListener('click', () => navigate('/'));
    viewer.addEventListener('keydown', (e: Event) => {
      const key = (e as KeyboardEvent).key;
      if (key === 'Enter' || key === ' ') {
        e.preventDefault();
        navigate('/');
      }
    });
  }
  document.addEventListener('astro:page-load', initModelViewerNav);
</script>
